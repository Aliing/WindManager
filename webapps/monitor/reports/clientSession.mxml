<?xml version="1.0"?>
<mx:Application xmlns:mx="http://www.adobe.com/2006/mxml" creationComplete="init()"
			paddingLeft="8" paddingTop="8" paddingRight="8" paddingBottom="8">

	<mx:HTTPService id="httpSvc"/>

	<mx:Script>
        <![CDATA[
        	import mx.controls.Alert;
			import mx.collections.ArrayCollection;
			import mx.charts.HitData;
			import mx.charts.series.LineSeries;
			import mx.charts.series.items.LineSeriesItem;
			var initURL: String; 
			
			public function dateParseFunction(s:String):Date { 
			    var temp:Array = s.split(" ");    
			    var datepart:String = temp[0];    
			    var datearray:Array = datepart.split("-"); 
			    var timepart:String = temp[1];    
			    var timearray:Array = timepart.split(":");   
			    var intMon:int =datearray[1];
			    var intDay:int =datearray[2];
			    var intHour:int =timearray[0];
			    var intMin:int =timearray[1]; 
			 
			    var testDate:Date = new Date();
				var offhour:Number = testDate.getTimezoneOffset()/60 *-1;
				var offmin:Number = testDate.getTimezoneOffset()%60 *-1
			  	var newDate:Date = new Date(datearray[0],intMon-1,intDay,intHour+offhour,intMin+offmin);   
			  	
			  	return newDate;    
			}
			public function init():void {
				if (Application.application.url.indexOf("monitor/reports")>=0){
					initURL = Application.application.url.substring(0, Application.application.url.indexOf("monitor/reports"));
				} else {
					initURL="";
				}
				httpSvc.url =initURL+ "reportList.action?operation=getFlashData&key=" + new Date().time;
				httpSvc.send();				
			 }
		    public function myDataTipFunction(e:HitData):String {
		
		       	var s:String;
		        s = "<B>" + LineSeries(e.element).displayName + "</B>\n";
		        s += "<I>Date Time:</I>" + e.item.date + "\n";
		        s += "<I>Value:</I>" + e.item.count + " frames\n";
		
		        return s
		    }	
		    public function myDataTipFunctionNoFrame(e:HitData):String {
		
		       	var s:String;
		        s = "<B>" + LineSeries(e.element).displayName + "</B>\n";
		        s += "<I>Date Time:</I>" + e.item.date + "\n";
		        s += "<I>Value:</I>" + e.item.count + "\n";
		
		        return s
		    }

		     public function clickButtonSession(event:Event):void {
		     	var sessionTime:String = sessionButton[event.target.repeaterIndices-rp.startingIndex].toolTip;
		     	sessionTime = sessionTime.replace(/:/g,"S");
		     	httpSvc.url = initURL+ "reportList.action?operation=getClientSessionData&reportClientSession=" + sessionTime +"&key=" + new Date().time;
				httpSvc.send();
		     }	
		     
		     public function clickButtonPreviousNext(currentPage:int):void {
		     	PreviousButton.enabled=false;
		     	NextButton.enabled=false;
		     	httpSvc.url = initURL+ "reportList.action?operation=getFlashData&currentPage=" + currentPage +"&key=" + new Date().time;
				httpSvc.send();
		     }
		     
		     public function enlargeButtonFunction():void {
		     	var i:int =0;
		     	if (enlargeButton.label=="Zoom In"){
			     	while (sessionButton[i] != null){
			     		sessionButton[i].width=sessionButton[i].width+20;
			     		i++;
			     	}
			     	enlargeButton.label="Zoom Out";
		     	} else {
		     		while (sessionButton[i] != null){
			     		sessionButton[i].width=sessionButton[i].width-20;
			     		i++;
			     	}
			     	enlargeButton.label="Zoom In";
		     	}
		     }
		     
		     public function getButtonWidth(sWidth:Number):Number{
		     	if (enlargeButton.label=="Zoom In"){
		     		return sWidth;
		     	} else {
		     		return sWidth + 20;
		     	}
		     }
		     public function getArrayColor():Array {
		     	//Alert.show("color");
		     	var temp:Array = ["#FFFFFF", "#FFFFFF"];
		     	if (rp.currentItem.buttonColor==null || rp.currentItem.buttonColor =="") {
		     		//Alert.show('getArrayColordd null');
		     		return temp;
		     	}
		     	temp = rp.currentItem.buttonColor.split(",");
		     	return temp;
		     }
		     public function getBorderColor(color:String):uint {
		     	if (color==null || color =="") {
		     		//Alert.show("getBorderColor " + "null");
		     		return 0xFFFFFF;
		     	}
		     	var temp:Array = color.split(",");
		     	if (temp[0].toString() == "#00FF00") {
		     		return 0x00FF00;
		     	} else if (temp[0].toString() == "#00AAFF") {
		     		return 0x00AAFF;
		     	} else {
		     		return 0xFFFFFF;
		     	}
		     }
        ]]>
    </mx:Script>
  	<mx:Panel width="100%" height="510" headerHeight="8">
	<mx:TitleWindow width="100%" height="70" headerHeight="0" layout="vertical">
	 	<mx:Grid verticalGap="0" horizontalGap="0" borderThickness="0" height="18" width="100%">
		    <mx:GridRow height="16" borderThickness="0">
		    	<mx:GridItem borderThickness="0">
		    		<mx:Label text="Session Graph"/>
		    	</mx:GridItem>
		    	<mx:GridItem borderThickness="0">
		    		<mx:Label text="" width="20"/>
		    	</mx:GridItem>
		    	<mx:GridItem borderThickness="0">
		    		<mx:Button label="Zoom In" fillColors="[#3E6C93, #3E6C93]" id="enlargeButton" click="enlargeButtonFunction()" cornerRadius="10" width="85"  height="14"/>
		    	</mx:GridItem>
		    </mx:GridRow>
		</mx:Grid>
	 	<mx:Grid verticalGap="0" horizontalGap="0" borderThickness="0" height="23" width="100%">
		    <mx:GridRow height="20" borderThickness="0">
				<mx:GridItem verticalAlign="bottom" borderThickness="0">
					<mx:Button label="Previous" fillColors="[#3E6C93, #3E6C93]" enabled="{httpSvc.lastResult.report.clientSession.previousButton.previousShowButton}" cornerRadius="10" width="80"  height="18" id="PreviousButton" click="{clickButtonPreviousNext(httpSvc.lastResult.report.clientSession.previousButton.previousPage)}"/>
				</mx:GridItem>
				<mx:GridItem verticalAlign="bottom" borderThickness="0" width="2">
				</mx:GridItem>
		    	<mx:Repeater id="rp" startingIndex="0" dataProvider="{httpSvc.lastResult.report.clientSession.lstReportClientSession.item}">
				    <mx:GridItem verticalAlign="bottom" borderThickness="0">
						<mx:Button label="" fillAlphas="[1.0, 1.0]" alpha="1.0" fillColors="{getArrayColor()}" borderColor="{getBorderColor(rp.currentItem.buttonColor)}" cornerRadius="0" width="{getButtonWidth(rp.currentItem.buttonWidth)}" toolTip="{rp.currentItem.sessionTime}" height="{rp.currentItem.buttonHeigth}" id="sessionButton" click="clickButtonSession(event)" />
					</mx:GridItem>
		    	</mx:Repeater>
				<mx:GridItem verticalAlign="bottom" borderThickness="0" width="2">
				</mx:GridItem>
				<mx:GridItem verticalAlign="bottom" borderThickness="0">
					<mx:Button label="Next" fillColors="[#3E6C93, #3E6C93]" enabled="{httpSvc.lastResult.report.clientSession.nextButton.nextShowButton}" cornerRadius="10" width="70"  height="18" id="NextButton" click="{clickButtonPreviousNext(httpSvc.lastResult.report.clientSession.nextButton.nextPage)}"/>
				</mx:GridItem>		
			</mx:GridRow>
		</mx:Grid>
	</mx:TitleWindow>
    <mx:Accordion width="100%" height="410">
        <mx:Canvas label="Client {httpSvc.lastResult.report.clientSession.clientMac} Information" width="100%" height="100%">
		    <mx:Grid verticalGap="0" paddingTop="2" paddingLeft="15" height="100%" width="100%">
		    	<mx:GridRow height="20">
			    	<mx:GridItem>
		    			<mx:Label text="Client User Name:"/>
					</mx:GridItem>
		    		<mx:GridItem>
						<mx:Label text="{httpSvc.lastResult.report.clientSession.clientUserName}"/>
					</mx:GridItem>
			    	<mx:GridItem>
		    			<mx:Label text="Client IP:"/>
					</mx:GridItem>
		    		<mx:GridItem>
						<mx:Label text="{httpSvc.lastResult.report.clientSession.clientIp}"/>
					</mx:GridItem>
		    	</mx:GridRow>
		    	<mx:GridRow height="20">
			    	<mx:GridItem>
		    			<mx:Label text="Client Associated Device MAC:"/>
					</mx:GridItem>
		    		<mx:GridItem>
						<mx:Label text="{httpSvc.lastResult.report.clientSession.clientApMac}"/>
					</mx:GridItem>
			    	<mx:GridItem>
		    			<mx:Label text="Client SSID:"/>
					</mx:GridItem>
		    		<mx:GridItem>
						<mx:Label text="{httpSvc.lastResult.report.clientSession.clientSSID}"/>
					</mx:GridItem>
		    	</mx:GridRow>
		    	<mx:GridRow height="20">
			    	<mx:GridItem>
		    			<mx:Label text="Client Associated Device Name:"/>
					</mx:GridItem>
		    		<mx:GridItem>
						<mx:Label text="{httpSvc.lastResult.report.clientSession.clientApName}"/>
					</mx:GridItem>
		    		<mx:GridItem>
		    			<mx:Label text="Client VLAN:"/>
					</mx:GridItem>
		    		<mx:GridItem>
		    			<mx:Label text="{httpSvc.lastResult.report.clientSession.clientVLAN}"/>
					</mx:GridItem>
		    	</mx:GridRow>
	    		<mx:GridRow height="20">
		    		<mx:GridItem>
		    			<mx:Label text="Client User Profile Attribute:"/>
					</mx:GridItem>
		    		<mx:GridItem>
		    			<mx:Label text="{httpSvc.lastResult.report.clientSession.clientUserProfile}"/>
					</mx:GridItem>
		    		<mx:GridItem>
		    			<mx:Label text="Client Channel:"/>
					</mx:GridItem>
		    		<mx:GridItem>
		    			<mx:Label text="{httpSvc.lastResult.report.clientSession.clientChannel}"/>
					</mx:GridItem>
	    		</mx:GridRow>
	    		<mx:GridRow height="20">
		    		<mx:GridItem>
		    			<mx:Label text="Client Encryption Method:"/>
					</mx:GridItem>
		    		<mx:GridItem>
		    			<mx:Label text="{httpSvc.lastResult.report.clientSession.clientEncryptionMethod}"/>
					</mx:GridItem>
		    		<mx:GridItem>
		    			<mx:Label text="Client Auth Method:"/>
					</mx:GridItem>
		    		<mx:GridItem>
		    			<mx:Label text="{httpSvc.lastResult.report.clientSession.clientAuthMethod}"/>
					</mx:GridItem>
	    		</mx:GridRow>
	    		<mx:GridRow height="20">
		    		<mx:GridItem>
		    			<mx:Label text="Client Physical Mode:"/>
					</mx:GridItem>
		    		<mx:GridItem>
		    			<mx:Label text="{httpSvc.lastResult.report.clientSession.clientPhysicalMode}"/>
					</mx:GridItem>
		    		<mx:GridItem>
		    			<mx:Label text="Client CWP Used:"/>
					</mx:GridItem>
		    		<mx:GridItem>
		    			<mx:Label text="{httpSvc.lastResult.report.clientSession.clientCWPUsed}"/>
					</mx:GridItem>
	    		</mx:GridRow>	
	    		<mx:GridRow height="20">
		    		<mx:GridItem>
		    			<mx:Label text="Client Session Start Time:"/>
					</mx:GridItem>
		    		<mx:GridItem>
		    			<mx:Label text="{httpSvc.lastResult.report.clientSession.clientSessionStartTime}"/>
					</mx:GridItem>
		    		<mx:GridItem>
		    			<mx:Label text="Client Link Uptime:"/>
					</mx:GridItem>
		    		<mx:GridItem>
		    			<mx:Label text="{httpSvc.lastResult.report.clientSession.clientLinkUpTime}"/>
					</mx:GridItem>
	    		</mx:GridRow>	
	    		<mx:GridRow height="20">
		    		<mx:GridItem>
		    			<mx:Label text="Client Session End Time:"/>
					</mx:GridItem>
		    		<mx:GridItem>
		    			<mx:Label text="{httpSvc.lastResult.report.clientSession.clientSessionEndTime}"/>
					</mx:GridItem>
		    		<mx:GridItem>
		    			<mx:Label text="Client Associated BSSID:"/>
					</mx:GridItem>
		    		<mx:GridItem>
		    			<mx:Label text="{httpSvc.lastResult.report.clientSession.clientBSSID}"/>
					</mx:GridItem>
	    		</mx:GridRow>			
	   		</mx:Grid>
	   	</mx:Canvas>
        <mx:Canvas label="{httpSvc.lastResult.report.clientSession.transmitTitle}" width="100%" height="100%">
    		<mx:VBox width="100%" height="100%">
			    <mx:LineChart id="transmitData" height="75%" width="100%" 
		    	    paddingRight="0" paddingLeft="0" 
		    	    dataTipFunction="myDataTipFunction"
		        	showDataTips="true">
		        	<mx:seriesFilters>
			           <mx:Array/>
			        </mx:seriesFilters>
		            <mx:horizontalAxis>
			            <mx:DateTimeAxis
			            	dataUnits="hours"
			            	parseFunction="dateParseFunction"/>
		    	    </mx:horizontalAxis>
		
		        	<mx:verticalAxis>
		            	<mx:LinearAxis baseAtZero="true"/>
		            </mx:verticalAxis>
		
			        <mx:series>
		    	        <mx:LineSeries yField="count" xField="date" dataProvider="{httpSvc.lastResult.report.clientSession.transmit.totalDataFrames.item}"
								displayName="Total Data Frames">
				            <mx:lineStroke>
				                <mx:Stroke color="0x0000FF"/>
				            </mx:lineStroke>   
						</mx:LineSeries>
		    	        <mx:LineSeries yField="count" xField="date" dataProvider="{httpSvc.lastResult.report.clientSession.transmit.beDataFrames.item}"
								displayName="WMM Best Effort Data Frames">
				            <mx:lineStroke>
				                <mx:Stroke color="0xFF0000"/>
				            </mx:lineStroke>   
						</mx:LineSeries>
		    	        <mx:LineSeries yField="count" xField="date" dataProvider="{httpSvc.lastResult.report.clientSession.transmit.bgDataFrames.item}"
								displayName="WMM Background Data Frames">
				            <mx:lineStroke>
				                <mx:Stroke color="0x00FF00"/>
				            </mx:lineStroke>   
						</mx:LineSeries>
		    	        <mx:LineSeries yField="count" xField="date" dataProvider="{httpSvc.lastResult.report.clientSession.transmit.viDataFrames.item}"
								displayName="WMM Video Data Frames">
				            <mx:lineStroke>
				                <mx:Stroke color="0xFFFF00"/>
				            </mx:lineStroke>   
						</mx:LineSeries>
		    	        <mx:LineSeries yField="count" xField="date" dataProvider="{httpSvc.lastResult.report.clientSession.transmit.voDataFrames.item}"
								displayName="WMM Voice Data Frames">
				            <mx:lineStroke>
				                <mx:Stroke color="0x00FFFF"/>
				            </mx:lineStroke>   
						</mx:LineSeries>
		    	        <mx:LineSeries yField="count" xField="date" dataProvider="{httpSvc.lastResult.report.clientSession.transmit.unicastDataFrames.item}"
								displayName="Unicast Data Frames">
				            <mx:lineStroke>
				                <mx:Stroke color="0xFF00FF"/>
				            </mx:lineStroke>   
						</mx:LineSeries>
		    	        <mx:LineSeries yField="count" xField="date" dataProvider="{httpSvc.lastResult.report.clientSession.transmit.mgtDataFrames.item}"
								displayName="Mgt Frames">
				            <mx:lineStroke>
				                <mx:Stroke color="0x000066"/>
				            </mx:lineStroke>   
						</mx:LineSeries>
		        	</mx:series>
		        </mx:LineChart>
         		<mx:Legend dataProvider="{transmitData}" width="100%" height="25%" fontSize="9" markerHeight="10" markerWidth="8"/>
			</mx:VBox>
		</mx:Canvas> 
        <mx:Canvas label="{httpSvc.lastResult.report.clientSession.receiveTitle}" width="100%" height="100%">
    		<mx:VBox width="100%" height="100%">
			    <mx:LineChart id="receiveData" height="80%" width="100%"
		    	    paddingRight="0" paddingLeft="0" 
		    	    dataTipFunction="myDataTipFunction"
		        	showDataTips="true">
		        	<mx:seriesFilters>
			           <mx:Array/>
			        </mx:seriesFilters>
		            <mx:horizontalAxis>
			            <mx:DateTimeAxis
			            	dataUnits="hours"
			            	parseFunction="dateParseFunction"/>
		    	    </mx:horizontalAxis>
		        	<mx:verticalAxis>
		            	<mx:LinearAxis baseAtZero="true"/>
		            </mx:verticalAxis>
			        <mx:series>
		    	        <mx:LineSeries yField="count" xField="date" dataProvider="{httpSvc.lastResult.report.clientSession.receive.totalDataFrames.item}"
								displayName="Total Data Frames">
				            <mx:lineStroke>
				                <mx:Stroke color="0x0000FF"/>
				            </mx:lineStroke>   
						</mx:LineSeries>
		    	        <mx:LineSeries yField="count" xField="date" dataProvider="{httpSvc.lastResult.report.clientSession.receive.unicastDataFrames.item}"
								displayName="Unicast Data Frames">
				            <mx:lineStroke>
				                <mx:Stroke color="0xFF0000"/>
				            </mx:lineStroke>   
						</mx:LineSeries>
		    	        <mx:LineSeries yField="count" xField="date" dataProvider="{httpSvc.lastResult.report.clientSession.receive.multicastDataFrames.item}"
								displayName="Multicast Data Frames">
				            <mx:lineStroke>
				                <mx:Stroke color="0x00FF00"/>
				            </mx:lineStroke>   
						</mx:LineSeries>
		    	        <mx:LineSeries yField="count" xField="date" dataProvider="{httpSvc.lastResult.report.clientSession.receive.broadcastDataFrames.item}"
								displayName="Broadcast Data Frames">
				            <mx:lineStroke>
				                <mx:Stroke color="0xFFFF00"/>
				            </mx:lineStroke>   
						</mx:LineSeries>
		    	        <mx:LineSeries yField="count" xField="date" dataProvider="{httpSvc.lastResult.report.clientSession.receive.mgtDataFrames.item}"
								displayName="Mgt Frames">
				            <mx:lineStroke>
				                <mx:Stroke color="0x000066"/>
				            </mx:lineStroke>   
						</mx:LineSeries>
		    	        <mx:LineSeries yField="count" xField="date" dataProvider="{httpSvc.lastResult.report.clientSession.receive.micFailures.item}"
								displayName="MIC Failures">
				            <mx:lineStroke>
				                <mx:Stroke color="0x00FFFF"/>
				            </mx:lineStroke>   
						</mx:LineSeries>
		        	</mx:series>
		        </mx:LineChart> 
         		<mx:Legend dataProvider="{receiveData}" width="100%" height="20%" fontSize="9" markerHeight="10" markerWidth="8"/>
			</mx:VBox>
		</mx:Canvas> 
        <mx:Canvas label="{httpSvc.lastResult.report.clientSession.dataOctetsTitle}" width="100%" height="100%">
    		<mx:VBox width="100%" height="100%">
			    <mx:LineChart id="DataOctets" height="90%" width="100%"
		    	    paddingRight="0" paddingLeft="0" 
		    	    dataTipFunction="myDataTipFunction"
		        	showDataTips="true">
		        	<mx:seriesFilters>
			           <mx:Array/>
			        </mx:seriesFilters>
		            <mx:horizontalAxis>
			            <mx:DateTimeAxis
			            	dataUnits="hours"
			            	parseFunction="dateParseFunction"/>
		    	    </mx:horizontalAxis>
		        	<mx:verticalAxis>
		            	<mx:LinearAxis baseAtZero="true"/>
		            </mx:verticalAxis>
			        <mx:series>
		    	        <mx:LineSeries yField="count" xField="date" dataProvider="{httpSvc.lastResult.report.clientSession.txdataOctets.item}"
								displayName="Transmitted Data Octets">
				            <mx:lineStroke>
				                <mx:Stroke color="0x0000FF"/>
				            </mx:lineStroke>   
						</mx:LineSeries>
		    	        <mx:LineSeries yField="count" xField="date" dataProvider="{httpSvc.lastResult.report.clientSession.rxdataOctets.item}"
								displayName="Received Data Octets">
				            <mx:lineStroke>
				                <mx:Stroke color="0xFF0000"/>
				            </mx:lineStroke>   
						</mx:LineSeries>
		        	</mx:series>
		        </mx:LineChart> 
         		<mx:Legend dataProvider="{DataOctets}" width="100%" height="10%" fontSize="9" markerHeight="10" markerWidth="8"/>
			</mx:VBox>
		</mx:Canvas> 
        <mx:Canvas label="{httpSvc.lastResult.report.clientSession.lastRateTitle}" width="100%" height="100%">
    		<mx:VBox width="100%" height="100%">
			    <mx:LineChart id="lastRate" height="90%" width="100%"
		    	    paddingRight="0" paddingLeft="0" 
		    	    dataTipFunction="myDataTipFunctionNoFrame"
		        	showDataTips="true">
		        	<mx:seriesFilters>
			           <mx:Array/>
			        </mx:seriesFilters>
		            <mx:horizontalAxis>
			            <mx:DateTimeAxis
			            	dataUnits="hours"
			            	parseFunction="dateParseFunction"/>
		    	    </mx:horizontalAxis>
		        	<mx:verticalAxis>
		            	<mx:LinearAxis baseAtZero="true"/>
		            </mx:verticalAxis>
			        <mx:series>
		    	        <mx:LineSeries yField="count" xField="date" dataProvider="{httpSvc.lastResult.report.clientSession.txLastRate.item}"
								displayName="Transmitted Last Rate">
				            <mx:lineStroke>
				                <mx:Stroke color="0x0000FF"/>
				            </mx:lineStroke>   
						</mx:LineSeries>
		    	        <mx:LineSeries yField="count" xField="date" dataProvider="{httpSvc.lastResult.report.clientSession.rxLastRate.item}"
								displayName="Received Last Rate">
				            <mx:lineStroke>
				                <mx:Stroke color="0xFF0000"/>
				            </mx:lineStroke>   
						</mx:LineSeries>
		        	</mx:series>
		        </mx:LineChart> 
         		<mx:Legend dataProvider="{lastRate}" width="100%" height="10%" fontSize="9" markerHeight="10" markerWidth="8"/>
			</mx:VBox>
		</mx:Canvas> 
        <mx:Canvas label="{httpSvc.lastResult.report.clientSession.rssiTitle}" width="100%" height="100%">
    		<mx:VBox width="100%" height="100%">
			    <mx:LineChart id="Rssi" height="90%" width="100%"
		    	    paddingRight="0" paddingLeft="0" 
		    	    dataTipFunction="myDataTipFunctionNoFrame"
		        	showDataTips="true">
		        	<mx:seriesFilters>
			           <mx:Array/>
			        </mx:seriesFilters>
		            <mx:horizontalAxis>
			            <mx:DateTimeAxis
			            	dataUnits="hours"
			            	parseFunction="dateParseFunction"/>
		    	    </mx:horizontalAxis>
		        	<mx:verticalAxis>
		            	<mx:LinearAxis baseAtZero="true"/>
		            </mx:verticalAxis>
			        <mx:series>
		    	        <mx:LineSeries yField="count" xField="date" dataProvider="{httpSvc.lastResult.report.clientSession.clientRssi.item}"
								displayName="Client RSSI">
				            <mx:lineStroke>
				                <mx:Stroke color="0x0000FF"/>
				            </mx:lineStroke>   
						</mx:LineSeries>
		        	</mx:series>
		        </mx:LineChart> 
         		<mx:Legend dataProvider="{Rssi}" width="100%" height="10%" fontSize="9" markerHeight="10" markerWidth="8"/>
			</mx:VBox>
		</mx:Canvas>
	</mx:Accordion>
	</mx:Panel>
</mx:Application>
